version: '3.8'

services:
  # ============================================================
  #  BASES DE DATOS
  # ============================================================

  db_usuarios_equipos:
    image: mysql:8
    container_name: db_usuarios_equipos
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: usuarios_equipos_db
    ports:
      - "3307:3306"
    volumes:
      - ./bd/usuarios_equipo_db.sql:/docker-entrypoint-initdb.d/usuarios_equipo_db.sql

  db_partidos:
    image: mysql:8
    container_name: db_partidos
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: partidos_db
    ports:
      - "3308:3306"
    volumes:
      - ./bd/partidos_db.sql:/docker-entrypoint-initdb.d/partidos_db.sql

  db_resultados:
    image: mysql:8
    container_name: db_resultados
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: resultados_db
    ports:
      - "3309:3306"
    volumes:
      - ./bd/resultados_db.sql:/docker-entrypoint-initdb.d/resultados_db.sql

  db_notificaciones:
    image: mysql:8
    container_name: db_notificaciones
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: notificaciones_db
    ports:
      - "3310:3306"
    volumes:
      - ./bd/notificaciones_db.sql:/docker-entrypoint-initdb.d/notificaciones_db.sql

  # ============================================================
  #  MICROSERVICIOS
  # ============================================================

  auth-service:
    build: ./microservices/auth-service
    container_name: auth-service
    restart: always
    ports:
      - "8081:8081"
    environment:
      DB_HOST: db_usuarios_equipos
      DB_PORT: 3306
      DB_NAME: usuarios_equipos_db
      DB_USER: root
      DB_PASSWORD: root
    depends_on:
      - db_usuarios_equipos

  equipo-jugador-service:
    build: ./microservices/equipo-jugador-service
    container_name: equipo-jugador-service
    restart: always
    ports:
      - "8082:8082"
    environment:
      DB_HOST: db_usuarios_equipos
      DB_PORT: 3306
      DB_NAME: usuarios_equipos_db
      DB_USER: root
      DB_PASSWORD: root
    depends_on:
      - db_usuarios_equipos

  partido-service:
    build: ./microservices/partido-service
    container_name: partido-service
    restart: always
    ports:
      - "8083:8083"
    environment:
      DB_HOST: db_partidos
      DB_PORT: 3306
      DB_NAME: partidos_db
      DB_USER: root
      DB_PASSWORD: root
    depends_on:
      - db_partidos

  resultado-service:
    build: ./microservices/resultado-service
    container_name: resultado-service
    restart: always
    ports:
      - "8084:8084"
    environment:
      DB_HOST: db_resultados
      DB_PORT: 3306
      DB_NAME: resultados_db
      DB_USER: root
      DB_PASSWORD: root
    depends_on:
      - db_resultados

  notificacion-service:
    build: ./microservices/notificacion-service
    container_name: notificacion-service
    restart: always
    ports:
      - "8085:8085"
    environment:
      DB_HOST: db_notificaciones
      DB_PORT: 3306
      DB_NAME: notificaciones_db
      DB_USER: root
      DB_PASSWORD: root
    depends_on:
      - db_notificaciones

  # ============================================================
  #  GATEWAY
  # ============================================================

  gateway:
    build: ./gateway
    container_name: gateway
    restart: always
    ports:
      - "8080:8080"
    depends_on:
      - auth-service
      - equipo-jugador-service
      - partido-service
      - resultado-service
      - notificacion-service
